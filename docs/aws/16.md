# Session 16: AWS Industry Quest – Manufacturing & Automotive (Week 2/3)

**Week:** 16  
**Element:** ICTIOT503 Element 2: Integrate multiple data sources  
**Duration:** ~4–5 hours  
**Phase:** Capstone Integration (AWS Industry Quest: Manufacturing & Automotive)

---

## Session Introduction

**Week 16** continues the AWS Industry Quest with focus on **fleet simulation**, **edge computing scenarios**, and **anomaly detection**. You'll expand from single digital twin (Week 15) to **multi-truck scenarios**, integrate **predictive algorithms**, and demonstrate real-time anomaly response on digital models.

**By the end of this week:** Your digital twin fleet will respond to sensor anomalies, predictive maintenance alerts will appear, and you'll have hands-on experience with edge processing in industrial IoT.

## Learning Objectives

By the end of Week 16, you will be able to:

- Expand digital twins from single truck to fleet scenario
- Implement anomaly detection algorithms integrated with TwinMaker
- Configure predictive maintenance rules based on sensor trends
- Simulate fleet-wide edge processing scenarios
- Prepare for final Capstone integration (Week 17)

---

## Session Structure

1. **AWS Industry Quest Labs 4–6** (continuing the 13-hour quest)
   - Lab 4: Fleet simulation setup
   - Lab 5: Predictive maintenance algorithms
   - Lab 6: Edge-to-cloud data pipeline

2. **Extend Your Digital Twin** – Add multi-truck visualization
3. **Implement Anomaly Detection** – Rules Engine + TwinMaker alerts
4. **Real-Hardware Extension** – Run anomaly on real truck, watch digital twin respond

---

## Pre-Session Preparation

!!! info "Completed by End of Week 15"
    - AWS Industry Quest enrollment active
    - Digital twin "RockCore-Truck-01" created in TwinMaker (Week 15)
    - Live telemetry binding verified (Week 15)
    - Labs 1–3 of Industry Quest complete

!!! tip "Hardware Check"
    - [ ] Haul truck still publishing MQTT telemetry
    - [ ] Temperature sensor functioning
    - [ ] Vibration sensor can be triggered by physical shaking
    - [ ] Anomaly detection rules (from Weeks 11–13) ready for testing

---

## AWS Industry Quest Labs 4–6: Fleet & Predictive Maintenance

### Lab 4: Fleet Simulation
**Expected Duration:** 1–1.5 hours

**Concepts:**
- Multiple assets in single TwinMaker workspace
- Synthetic data generation (simulating other trucks)
- Real truck + simulated trucks side-by-side

**Your Task:**
- Add **2 more digital truck twins** to your TwinMaker scene:
  - Truck-02: Simulate normal operation (synthetic telemetry)
  - Truck-03: Simulate degraded state (trending toward failure)

- In your `haul-truck-fleet` scene:
  - Position 3 trucks in 3D space
  - Show real data for Truck-01 (your physical device)
  - Show simulated data for Trucks 02 & 03

### Lab 5: Predictive Maintenance Algorithms
**Expected Duration:** 1.5–2 hours

**Concepts:**
- Anomaly detection algorithms (moving average, standard deviation, threshold crossing)
- Predictive models (trending vibration → predict failure in N days)
- Rule triggering based on ML insights

**Your Task:**
- Implement **vibration anomaly detection** rule:
  - If vibration > 3-sigma above 7-day rolling average → `ANOMALY_DETECTED`
  - Push alert to TwinMaker property `VibrationAnomalyStatus`

- Create **predictive maintenance alert**:
  - Track vibration trend over past 3 shifts
  - If slope > 0.5 units/hour → `MAINTENANCE_REQUIRED_72H`

- **Visualize on digital twin:**
  - Truck-01 body color: Green (normal) → Yellow (anomaly) → Red (maintenance needed)

### Lab 6: Edge-to-Cloud Data Pipeline
**Expected Duration:** 1–1.5 hours

**Concepts:**
- AWS Greengrass running on edge (laptop in this case)
- Local processing before cloud transmission
- Sync when connection restored

**Your Task:**
- If you completed Greengrass deployment in Week 13:
  - Run anomaly detection **locally** on Greengrass
  - Send alert to cloud only when threshold crossed (saves bandwidth)
  - Demonstrate 5-minute offline period → messages queued → resync when online

- If not completed Week 13:
  - Simulate edge processing with Lambda@Edge or EC2
  - Focus on understanding the **concept** and data flow

---

## Hands-On: Extend to Multi-Truck Fleet

### Step 1: Update TwinMaker Scene with Fleet View

**AWS IoT TwinMaker:**

**Add new entities for Trucks 02 & 03:**

```json
{
  "entityId": "RockCore-Truck-02",
  "entityName": "Haul Truck 02 (Simulated – Normal)",
  "description": "Healthy truck with stable telemetry",
  "properties": {
    "temperature": 45,
    "vibration": 1.2,
    "gas_level": 75,
    "locked": true,
    "status": "healthy"
  }
}

{
  "entityId": "RockCore-Truck-03",
  "entityName": "Haul Truck 03 (Simulated – Degraded)",
  "description": "Truck showing predictive maintenance signals",
  "properties": {
    "temperature": 58,
    "vibration": 2.8,
    "gas_level": 45,
    "locked": true,
    "status": "degraded",
    "maintenance_in_hours": 72
  }
}
```

### Step 2: Create Fleet View Scene

In TwinMaker Scene editor:

1. Import 3 truck 3D models or primitives
2. Arrange in a 3D space (e.g., mining pit layout)
3. Assign entities:
   - Model 1 → RockCore-Truck-01 (real telemetry)
   - Model 2 → RockCore-Truck-02 (simulated normal)
   - Model 3 → RockCore-Truck-03 (simulated degraded)

4. Add **status indicators** (overlays):
   - Truck-01: Green label "Live Data", real-time temperature
   - Truck-02: Blue label "Simulated", stable values
   - Truck-03: Orange label "⚠ Predictive Alert", countdown "70 h maintenance"

### Step 3: Implement Anomaly Rules

**AWS IoT Core Rules Engine:**

Create rule: `anomaly_detection`

```sql
SELECT
  truck,
  temperature,
  vibration,
  CASE 
    WHEN vibration > 4.0 THEN 'CRITICAL'
    WHEN vibration > 3.0 THEN 'WARNING'
    ELSE 'NORMAL'
  END as anomaly_status,
  timestamp
FROM 'rockcore/trucks/+/telemetry'
```

**Topic to Publish:**
- Topic: `rockcore/anomalies`
- Forward to: **Lambda function** → **TwinMaker Update API**

**Lambda Function (Python):**

```python
import json
import boto3
import time

twinmaker = boto3.client('iottwinmaker')

def lambda_handler(event, context):
    truck = event['truck']
    anomaly = event['anomaly_status']
    
    # Update TwinMaker entity property
    twinmaker.update_entity(
        workspaceId='rockcore-mining',
        entityId=f'RockCore-{truck}',
        entityUpdate={
            'properties': {
                'AnomalyStatus': {
                    'definition': {
                        'dataType': 'STRING',
                        'isTimeSeries': True
                    },
                    'updateType': 'CREATE',
                    'value': {
                        'stringValue': anomaly
                    }
                }
            }
        }
    )
    
    return {
        'statusCode': 200,
        'body': json.dumps(f'Updated {truck} anomaly status: {anomaly}')
    }
```

### Step 4: Test Anomaly Response

**Simulate vibration spike on real truck:**

1. **Shake the physical ESP32 device** (Week 15) to trigger vibration sensor
2. **Monitor MQTT:**
   ```bash
   aws iot-data get-thing-shadow --thing-name haul-truck-01
   ```
   Verify vibration value increases

3. **Check TwinMaker scene:**
   - Truck-01 color should change to Yellow/Red
   - Anomaly overlay should appear (e.g., "⚠ Vibration High")

4. **Capture screenshot:**
   - 3-truck fleet view
   - Truck-01 showing anomaly state (in response to real sensor)
   - Timestamp

---

## Assessment Preparation

This week adds **evidence for A6 (Capstone):**

**Deliverable Screenshots (collect by end of Week 16):**
- [ ] TwinMaker fleet scene with 3 trucks (real + 2 simulated)
- [ ] Anomaly triggered on real truck (vibration spike → color change on digital twin)
- [ ] Rules Engine rule for anomaly detection (screenshot of rule config)
- [ ] Lambda logs showing TwinMaker updates (timestamp + anomaly event)

**By end of Week 17**, compile these into:
- Short video (2–3 minutes): "Fleet Monitoring with Digital Twins"
- Show truck shaking → digital twin responds → pit station sees alert

---

## Troubleshooting

**Q: TwinMaker updates not appearing in real-time?**  
A: Check Lambda IAM permissions (`iottwinmaker:UpdateEntity`), and verify SQS/SNS delivery of rule trigger.

**Q: Simulated trucks showing stale data?**  
A: Refresh TwinMaker scene or set data connectors to poll every 30 seconds instead of 5 minutes.

**Q: How do I generate synthetic telemetry for Trucks 02 & 03?**  
A: Use a Node.js/Python script publishing mock MQTT messages, or manually update via AWS Console (TwinMaker → Entity → Edit Property).

**Q: Can I skip Labs 4–6 and just focus on Week 15 digital twin?**  
A: Not ideal for A6, but if time-constrained, at least complete Lab 4 (fleet view) by end of Week 16.

---

## What's Next

**Week 17:** Final Industry Quest labs (Labs 7–13), full manufacturing scenario, multi-truck predictive maintenance, and prepare capstone submission with digital twin + real IoT system.

---

## Navigation

[← Week 15 (Industry Quest 1/3)](15.md) | [Course Overview](../overview.md) | [Week 17 (Industry Quest 3/3) →](17.md)
