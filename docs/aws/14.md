# Session 14: Analytics & Visualization

**Week:** 14  
**Element:** ICTIOT503 Element 1: Scope design options for analytics  
**Duration:** 3.5 hours  
**Phase:** AWS IoT Integration (Final)

---

## Session Introduction

Final AWS week! You'll build a complete analytics and visualization stack using **AWS IoT SiteWise** for asset modeling, **IoT Analytics** for time-series processing, and **QuickSight** for dashboards. Complete AWS Skill Builder course + 3 SimuLearn manufacturing labs to create the pit station operator dashboard.

## Learning Objectives

By the end of this session, you will be able to:

- Model haul trucks as SiteWise assets
- Configure IoT Analytics pipelines
- Create QuickSight dashboards for fleet monitoring
- Implement historical trend analysis
- Complete AWS IoT integration ready for Capstone

---

## Session Structure

1. **AWS Skill Builder** – Analyzing & Visualizing Data (45 min)
2. **SimuLearn Labs** – Manufacturing & Automotive (3 labs)
3. **SiteWise Asset Model** – Haul-Truck-01 hierarchy
4. **IoT Analytics Pipeline** – Data processing
5. **QuickSight Dashboard** – Live fleet monitoring

---

## Pre-Session Preparation

!!! info "Required Completion"
    - AWS Skill Builder: [Analyzing, Visualizing, and Gaining Insights](https://explore.skillbuilder.aws/) (45 min)
    - SimuLearn: "Manufacturing and Automotive" first 3 labs
    - Truck publishing to AWS from Week 10-13

!!! tip "Setup Check"
    - [ ] AWS SiteWise enabled in your region
    - [ ] QuickSight account created (free trial)
    - [ ] IoT Analytics channel/pipeline setup

---

## RockCore Mining Context

**Pit Station Requirement:** Supervisors need a single dashboard showing:
- All 20 trucks: location, status, temperature, vibration
- Historical trends: Which trucks show increasing vibration over 30 days?
- Predictive alerts: Maintenance scheduling before failure
- Cost tracking: Downtime per truck per shift

Today you'll build the prototype dashboard for HC-01, ready to scale to full fleet in Capstone.

---

## AWS Skill Builder + SimuLearn (Complete First)

### Course: Analyzing, Visualizing, and Gaining Insights (45 min)
**Topics:**
- IoT Analytics concepts
- Time-series data processing
- Visualization best practices

### SimuLearn Labs (First 3 only):
1. **Manufacturing Data Ingestion**
2. **Automotive Telemetry Processing**
3. **Equipment Health Dashboards**

**Deliverable:** Screenshots of completion.

---

## Hands-On Tasks

### Task 1: IoT Analytics Pipeline

**AWS Console → IoT Analytics:**

**Create Channel:**
- Name: `rockcore_telemetry_channel`
- Source: IoT Core rule → `rockcore/trucks/+/telemetry`

**Create Pipeline:**
```python
# rockcore_pipeline - SQL transform
SELECT 
  truck,
  temp as temperature,
  vibration,
  gas_level,
  status,
  from_unixtime(timestamp/1000) as event_time,
  timestamp
FROM rockcore_telemetry_channel
WHERE temp IS NOT NULL
  AND vibration IS NOT NULL
```

**Create Data Store:**
- Name: `rockcore_data_store`
- Retention: 90 days

**Create Dataset:**
```sql
SELECT 
  truck,
  AVG(temperature) as avg_temp,
  MAX(temperature) as max_temp,
  AVG(vibration) as avg_vibration,
  COUNT(*) as sample_count,
  DATE_TRUNC('hour', event_time) as time_bucket
FROM rockcore_data_store
GROUP BY truck, DATE_TRUNC('hour', event_time)
ORDER BY time_bucket DESC
```

### Task 2: SiteWise Asset Model

**AWS Console → IoT SiteWise → Models:**

**Create Asset Model: "Haul-Truck"**

Properties:
- `truck_id` (String attribute)
- `temperature` (Measurement, °C)
- `vibration` (Measurement, g)
- `gas_level` (Measurement, ADC value)
- `engine_hours` (Measurement, hours)
- `avg_temp_1h` (Transform: AVG over 1 hour)
- `vibration_trend` (Metric: Linear regression slope)

**Create Asset: "HC-01"**
- Model: Haul-Truck
- Hierarchy: Fleet → Zone-A → HC-01

**Ingest Data from IoT Core:**

Create IoT Rule → SiteWise action:
```json
{
  "propertyAlias": "/rockcore/HC-01/temperature",
  "propertyValue": "${temp}",
  "timestamp": {
    "timeInSeconds": "${floor(timestamp()/1000)}"
  }
}
```

### Task 3: QuickSight Dashboard

**Setup:**
1. Create QuickSight account (Enterprise edition for embedded dashboards)
2. Connect to IoT Analytics dataset: `rockcore_data_store`
3. Or connect to SiteWise (direct integration)

**Dashboard Widgets:**

**1. Fleet Status Table**
```
Truck ID | Status | Temp | Vibration | Last Update
HC-01    | OK     | 62°C | 1.2g      | 2 min ago
```

**2. Temperature Trend (Line Chart)**
- X-axis: Time (last 24 hours)
- Y-axis: Temperature
- Series: All trucks

**3. Vibration Heatmap**
- Rows: Truck ID
- Columns: Hour of day
- Color: Vibration level (green < 1.5, yellow < 2.0, red > 2.0)

**4. Alert Summary (KPI)**
- Total anomalies today
- Trucks in WARNING state
- Trucks in CRITICAL state

**5. Predictive Maintenance Table**
```
Truck | Days Until Service | Issue | Priority
HC-03 | 5                 | Tire  | High
HC-07 | 12                | Oil   | Medium
```

### Task 4: Real-Time Dashboard Integration

**Embed QuickSight in Web App (Bonus):**

```html
<!-- pit_station_dashboard.html -->
<!DOCTYPE html>
<html>
<head>
  <title>RockCore Pit Station</title>
  <script src="https://unpkg.com/amazon-quicksight-embedding-sdk@1.0.15/dist/quicksight-embedding-js-sdk.min.js"></script>
</head>
<body>
  <h1>RockCore Fleet Monitor</h1>
  <div id="dashboard-container"></div>
  
  <script>
    var dashboard;
    function embedDashboard() {
      var containerDiv = document.getElementById("dashboard-container");
      var options = {
        url: "https://quicksight.aws.amazon.com/embed/...",
        container: containerDiv,
        height: "700px",
        width: "100%"
      };
      dashboard = QuickSightEmbedding.embedDashboard(options);
    }
    embedDashboard();
  </script>
</body>
</html>
```

### Task 5: Historical Trend Analysis

**Query IoT Analytics for 30-day vibration trend:**

```sql
-- Run in IoT Analytics console
SELECT 
  truck,
  DATE_TRUNC('day', event_time) as day,
  AVG(vibration) as daily_avg_vibration,
  STDDEV(vibration) as vibration_variance
FROM rockcore_data_store
WHERE event_time > current_timestamp - interval '30' day
GROUP BY truck, DATE_TRUNC('day', event_time)
ORDER BY truck, day;
```

**Export to S3 for ML model training (Week 15 preview):**
```bash
aws iotanalytics create-dataset-content \
  --dataset-name rockcore_historical_trends \
  --schedule-configuration 'schedule="rate(1 day)"'
```

---

## Check Your Knowledge

!!! question "Q1 – SiteWise vs IoT Analytics"
    When should you use SiteWise instead of IoT Analytics?
    ??? tip "Answer"
        SiteWise: Industrial equipment modeling with asset hierarchies, OPC-UA integration, built-in industrial analytics. IoT Analytics: Custom SQL pipelines, ML integration, general-purpose time-series data. Use both together!

!!! question "Q2 – Dashboard Refresh Rate"
    QuickSight dashboards refresh every 1 hour by default. How do you achieve real-time monitoring?
    ??? tip "Answer"
        Use SPICE (in-memory) refresh schedules (minimum 15 min for Enterprise), or embed live IoT Analytics queries, or use AppSync + GraphQL subscriptions for true real-time.

!!! question "Q3 – Cost Optimization"
    Storing raw telemetry (5 sec intervals) for 20 trucks × 90 days = 31 million records. How reduce costs?
    ??? tip "Answer"
        1) Aggregate to 1-min averages in pipeline, 2) Use S3 cold storage after 7 days, 3) Compress data, 4) Sample less frequently (30 sec intervals acceptable for non-critical metrics).

---

## Portfolio Checkpoint

**Submit to GitHub:**

1. AWS Skill Builder + SimuLearn completion screenshots
2. **SiteWise asset screenshot** showing HC-01 with live properties
3. **IoT Analytics dataset preview** (first 10 rows of processed data)
4. **QuickSight dashboard** screenshot with all 5 widgets
5. **Test video** (4-5 minutes):
   - ESP32 publishing data
   - Data appearing in SiteWise (refresh to show update)
   - QuickSight dashboard showing temperature trend
   - Trigger vibration anomaly → show alert in dashboard
6. **Architecture diagram** (full stack):
   - ESP32 → IoT Core → Rules Engine → SiteWise + IoT Analytics → QuickSight

---

## Week 15 Preview: Capstone Integration

Next week starts the 4-week Capstone where you'll:
- Integrate Weeks 1-14 into complete system
- Build physical pit station with LCD display
- Implement fleet simulation (multiple trucks)
- Add Lambda-based predictive maintenance alerts
- Create comprehensive portfolio mapping to all assessment criteria

---

**Navigation:** [← Week 13](13.md) | [Course Overview](../overview.md) | [Week 15 (Capstone) →](../capstone/integration.md)
