# Session 05: I²C & Actuators

**Week:** 5  
**Element:** ICTIOT503 Element 3: Produce design documentation | ICTIOT502 Element 2: Program IoT device  
**Duration:** 3.5 hours  
**Phase:** Electronics for Programmers

---

> **Note:** All electronics sessions can be completed using either Arduino (C++) or MicroPython on the ESP32. You may choose your preferred language for all programming tasks, code submissions, and portfolio checkpoints.

---

## Session Introduction

This week you'll add the OLED display and accelerometer (GY-521) to your truck, plus a servo motor for simulating the dump bed. You'll learn I²C bus communication – a critical protocol for industrial sensor networks. This session launches **Assessment 3** (Tire & Suspension Health Monitor) and **Assessment 4** (Payload & Load Management).

## Learning Objectives

By the end of this session, you will be able to:

- Configure and use I²C communication protocol
- Display sensor data on OLED screen
- Read accelerometer data from GY-521 (MPU6050)
- Control servo motors with precise positioning
- Start Assessments 3 & 4 design documentation

---

## Session Structure

1. **I²C Protocol** – Theory and wiring
2. **OLED Display** – Real-time data visualization
3. **GY-521 Accelerometer** – Vibration and tilt detection
4. **Servo Control** – Dump bed simulation
5. **Assessment Launch** – Design documentation requirements

---

## Pre-Session Preparation

!!! info "Required Reading"
    - PhysComp → [I2C Communication](https://makeabilitylab.github.io/physcomp/communication/i2c.html)
    - PhysComp → [Servo Motors](https://makeabilitylab.github.io/physcomp/arduino/servo-motors.html)
    - GY-521 (MPU6050) datasheet overview

!!! tip "Setup Check"
    - [ ] Real ESP32 kit ready
    - [ ] Install libraries: `Adafruit SSD1306`, `Adafruit GFX`, `MPU6050` (by Electronic Cats)
    - [ ] 3D print base panel and back panel parts

---

## RockCore Mining Context

Modern haul trucks use I²C sensor networks to monitor dozens of data points simultaneously. Today you'll implement:

- **OLED Display** (Base panel): Shows truck status at a glance
- **GY-521 Accelerometer** (Base panel): Detects tire imbalance and suspension issues
- **Servo Motor** (Back panel): Simulates hydraulic dump bed for payload management

I²C allows all these devices to share just two wires (SDA/SCL) plus power – essential when space is limited.

---

## Hands-On Tasks

### Task 1: OLED Display Setup (I²C)

**Wiring:**
- SDA → GPIO 21
- SCL → GPIO 22
- VCC → 3.3V
- GND → GND

```cpp
// Week 5 Task 1 - OLED Display
#include <Wire.h>
#include <Adafruit_GFX.h>
#include <Adafruit_SSD1306.h>

#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 64
#define OLED_RESET -1

Adafruit_SSD1306 display(SCREEN_WIDTH, SCREEN_HEIGHT, &Wire, OLED_RESET);

void setup() {
  Serial.begin(115200);
  
  if(!display.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
    Serial.println("OLED not found - check I2C address");
    while(1);
  }
  
  display.clearDisplay();
  display.setTextSize(1);
  display.setTextColor(SSD1306_WHITE);
  display.setCursor(0,0);
  display.println("RockCore Mining");
  display.println("Truck ID: HC-01");
  display.println("Status: Ready");
  display.display();
}

void loop() {
  // Update display with sensor data (next tasks)
}
```

### Task 2: GY-521 Accelerometer (Vibration Detection)

**Wiring:** Shares same I²C bus as OLED (daisy-chain SDA/SCL).

```cpp
// Week 5 Task 2 - GY-521 Accelerometer
#include <Wire.h>
#include <MPU6050.h>

MPU6050 mpu;

void setup() {
  Serial.begin(115200);
  Wire.begin();
  
  if (!mpu.begin(MPU6050_SCALE_2000DPS, MPU6050_RANGE_2G)) {
    Serial.println("MPU6050 not found - check wiring");
    while(1);
  }
}

void loop() {
  Vector normAccel = mpu.readNormalizeAccel();
  
  Serial.print("X: ");
  Serial.print(normAccel.XAxis);
  Serial.print(" | Y: ");
  Serial.print(normAccel.YAxis);
  Serial.print(" | Z: ");
  Serial.println(normAccel.ZAxis);
  
  // Vibration detection (for Assessment 3)
  float totalAccel = sqrt(normAccel.XAxis * normAccel.XAxis + 
                          normAccel.YAxis * normAccel.YAxis + 
                          normAccel.ZAxis * normAccel.ZAxis);
  
  if (totalAccel > 1.5) {  // Threshold tuning required
    Serial.println("WARNING: High vibration - tire imbalance?");
  }
  
  delay(100);
}
```

### Task 3: Servo Motor Control (Dump Bed)

**Wiring:**
- Servo signal → GPIO 18
- Servo VCC → 5V (external power recommended for full-size servos)
- Servo GND → GND

```cpp
// Week 5 Task 3 - Servo Dump Bed Simulation
#include <ESP32Servo.h>

Servo dumpServo;
const int SERVO_PIN = 18;

void setup() {
  Serial.begin(115200);
  dumpServo.attach(SERVO_PIN);
  dumpServo.write(0);  // Start position: bed down
  Serial.println("Dump bed ready");
}

void loop() {
  // Simulate dump cycle
  Serial.println("Raising dump bed...");
  for(int pos = 0; pos <= 120; pos++) {
    dumpServo.write(pos);
    delay(15);
  }
  delay(2000);
  
  Serial.println("Lowering dump bed...");
  for(int pos = 120; pos >= 0; pos--) {
    dumpServo.write(pos);
    delay(15);
  }
  delay(5000);
}
```

### Task 4: Integrated Display (OLED + GY-521)

```cpp
// Week 5 Task 4 - Combined OLED + Accelerometer
#include <Wire.h>
#include <Adafruit_SSD1306.h>
#include <MPU6050.h>

Adafruit_SSD1306 display(128, 64, &Wire, -1);
MPU6050 mpu;

void setup() {
  display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
  mpu.begin(MPU6050_SCALE_2000DPS, MPU6050_RANGE_2G);
}

void loop() {
  Vector accel = mpu.readNormalizeAccel();
  
  display.clearDisplay();
  display.setCursor(0,0);
  display.println("RockCore HC-01");
  display.println("---Vibration---");
  display.print("X: "); display.println(accel.XAxis, 2);
  display.print("Y: "); display.println(accel.YAxis, 2);
  display.print("Z: "); display.println(accel.ZAxis, 2);
  
  float total = sqrt(accel.XAxis*accel.XAxis + accel.YAxis*accel.YAxis + accel.ZAxis*accel.ZAxis);
  if (total > 1.5) {
    display.println("ALERT: High vibe!");
  }
  display.display();
  
  delay(200);
}
```

---

## Check Your Knowledge

!!! question "Q1 – I²C Addressing"
    How can multiple I²C devices share the same two wires without conflicts?
    ??? tip "Answer"
        Each I²C device has a unique address (e.g., OLED=0x3C, MPU6050=0x68). The master (ESP32) specifies which address to communicate with, and only that device responds.

!!! question "Q2 – Accelerometer Applications"
    Besides vibration, what else can the GY-521 detect for your truck?
    ??? tip "Answer"
        Tilt angle (is truck on steep incline?), sudden impacts (collision detection), and orientation (is truck tipped over?).

!!! question "Q3 – Servo Power"
    Why might you need external power for the servo instead of ESP32's 5V pin?
    ??? tip "Answer"
        Servos can draw 500mA+ under load. ESP32's 5V pin is limited to ~500mA total, which could brown out the microcontroller when the servo moves.

---

## Assessment 3 Launch: Tire & Suspension Health Monitor

**Due:** Week 8

**Requirements:**
- GY-521 accelerometer for vibration monitoring
- Ultrasonic sensor for suspension height measurement
- Design diagrams showing I²C bus integration
- Test plan for simulated tire imbalance

**Mapping:** ICTIOT503 Element 3 – Produce design documentation, document compatibility (I²C bus integration).

**Task this week:** Create system architecture diagram showing I²C bus with all devices.

---

## Assessment 4 Launch: Payload & Load Management

**Due:** Week 9

**Requirements:**
- Servo motor for dump bed simulation
- Water level sensor for load weight estimation
- Evaluation of servo vs stepper motor (design documentation)
- Scalability plan for fleet-wide deployment

**Mapping:** ICTIOT503 Element 2 – Evaluate design options and resources.

**Task this week:** Research servo torque requirements and power management strategies.

---

## Portfolio Checkpoint

**Save to GitHub:**

1. Code for all four tasks (OLED, GY-521, Servo, Integrated)
2. Video showing OLED displaying real-time accelerometer data
3. Wiring photo showing I²C daisy-chain (OLED + GY-521)
4. Start Assessment 3 design document (system diagram)

---

**Navigation:** [← Week 4](04.md) | [Course Overview](../overview.md) | [Week 6 →](06.md)
